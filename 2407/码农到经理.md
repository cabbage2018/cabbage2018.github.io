# costdown之路1 一款便宜到会员价的服务器软件引发的泥石流 #

项目组中标了一个重工行业的标，网络拓扑是利用现有的电力SCADA 数据来驱动数字化管理系统。例如能碳和能源。shi公司安装的SCADA 系统的北向暴露接口是OPC DA，而且还是版本1.0！不是所有的通信协议都能称为协议的。不通用，无法跨平台那种顶多称为通道。这次就完完全全印证了数据通道这种技术，虽然一开始部署和安装成本低，但是后期的定制化和扩展功能基本上是不可能的。即使呼叫原先的供应商它也不一定会接。接了也是通过手段而不是技术去做的。
就拿这DA 通道来说，老老实实做就是安装一个格式转换器，例如UA，那么你可以攒一款软件既作为DA 客户端且作为UA 服务器。巧就巧在这个OPC 组委会还开发了一款跨平台的通道叫做XML DA。这个通道可以借助DA 的安全控制和group 和tag 层级描述点位，又能通过webservice 发布出去，XML 早期就是Microsoft 介入Web领域的一个尝试，像soap 等访问核心就是XML 数据格式。但是这种温室的花朵长不过野生的JSON。 这慢慢地这种轻量级甚至人肉可以识别阅读的格式占据了数据交换场合甚至web，例如jwt token 交换协议也用到。这个项目有3拨人工作在3个层面：shi公司安装的SCADA提供数据源；rs 公司的数据转换器工作在数字化服务器上；dec公司的App 工作在rs 的数据转换器之上。 但凡rs 外购的这100块的转换器软件掉链子影响的是领导台面上的大屏，客户集团的负责数字化业务的创新团队是要甩锅的。并且，这个项目的部署是安装到tx 公司的基础设施PaaS ，这就更加增加了不确定性。项目上线后一直数据异常。开发工程师wireshark 抓包分析后发现是ack 确认帧丢失，造成确认乱序，就是server 无法确认client ，client 就在freesolo。数据异常，丢数对技术专家来说是大事，客户也和tx 大公司组织了攻关小组，但是他们没有经验，并未能利用SCADA 的通信服务器来部署一个近点的转换软件而是在局域网重新又安装了一个DA 的客户端。这个客户端调了超过一个月也没通。于是这两家又重新把矛头指向dec。 这种情况下最重要的就是顶住压力绝对不能自己揽下这个活，虽然技术上dec公司技术人员知道只要将接口稍微调整一下从捆绑地址换成单个地址访问就能避免乱序，但是技术和架构和售前商量后意识到这不是技术问题，而绝对是商务战略-就是说，我卖给你100块钱的工具它就只能工作在1024个数据点，我卖给你4万块钱的SaaS APP我就只给你存500G历史。我如果卖给你13万的on premise 数字孪生那必须提供单线图、3000个表计、5万个点。 扯远了单从这个项目分析，600块表，2万多个点位，本身的采集压力还是很大的，现在再夹杂这些稳定性的故障让项目经理和需求经理抓狂-因为这款软件真正是哈姆雷特一千个用户眼中有一千个这家伙。
先不说其它的，就理一下整个链条 有一些表的采集有问题；固定一群；没有问题的从来没问题，有问题的也不是一直有问题；有的时间点有问题，提出界面显示的因素在数据库角度看就是缺少记录空白空间；日志显示的是bad sequence number=securityChecksFail； 抓包显示TCP ack和seq 错误；有这些信息基本上就可以去和供方沟通了。
